(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[718],{1920:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var a=t(5155),l=t(2115),r=t(2108),n=t(6710),o=t(3988),i=t(690),c=t(9869),d=t(646),m=t(1243),x=t(2657),u=t(1788);let g=["jpg","jpeg","png","webp","avif","heic","tiff","bmp","gif","svg"];function h(){let{data:e}=(0,r.useSession)(),[s,t]=(0,l.useState)("webp"),[h,p]=(0,l.useState)(85),[f,b]=(0,l.useState)([]),[v,j]=(0,l.useState)(0),N=null==e?void 0:e.idToken,{getRootProps:w,getInputProps:k,isDragActive:y}=(0,n.VB)({onDrop:e=>{let s=e.map(e=>({file:e,status:"queued"}));b(e=>[...e,...s])},multiple:!0}),C=async()=>{for(let e of f.filter(e=>"queued"===e.status)){b(s=>s.map(s=>s===e?{...s,status:"running"}:s));let t=new FormData;t.append("file",e.file),t.append("to",s),t.append("quality",String(h));try{console.log("Starting conversion for:",e.file.name,"to",s),console.log("API_URL:",o.H),console.log("Token present:",!!N);let a=await fetch("".concat(o.H,"/api/convert"),{method:"POST",headers:N?{Authorization:"Bearer ".concat(N)}:void 0,body:t});if(console.log("Response status:",a.status),console.log("Response ok:",a.ok),401===a.status)throw Error("Please sign in with Google to convert.");if(402===a.status)throw Error("Daily limit reached (20 free conversions). Sign in and subscribe for unlimited conversions.");if(!a.ok)throw Error("Conversion failed: ".concat(a.status));let l=await a.blob(),r=URL.createObjectURL(l);console.log("Conversion successful, blob URL created:",r),console.log("Current job object:",e),b(s=>{console.log("Previous jobs state:",s);let t=s.map(s=>s.file.name===e.file.name&&"running"===s.status?(console.log("Updating job from running to done:",s),{...s,status:"done",url:r}):s);return console.log("New jobs state:",t),t}),j(e=>(console.log("Updating refresh key from",e,"to",e+1),e+1))}catch(s){console.error("Conversion error:",s),b(t=>t.map(t=>t===e?{...t,status:"error",error:s.message}:t))}}};return(0,l.useEffect)(()=>{console.log("Jobs state changed:",f)},[f]),(0,l.useEffect)(()=>{console.log("RefreshKey changed:",v)},[v]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("h1",{className:"text-xl font-semibold text-sky-800 flex items-center gap-2",children:[(0,a.jsx)(i.A,{className:"text-sky-600"})," Convert Images"]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-white p-4",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-600 mb-1",children:"Target format"}),(0,a.jsx)("select",{value:s,onChange:e=>t(e.target.value),className:"w-full rounded-md border-slate-300",children:g.map(e=>(0,a.jsx)("option",{value:e,children:e.toUpperCase()},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-600 mb-1",children:"Quality"}),(0,a.jsx)("input",{type:"range",min:1,max:100,value:h,onChange:e=>p(Number(e.target.value)),className:"w-full"}),(0,a.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:h})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("button",{onClick:C,className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-white hover:bg-sky-700",children:[(0,a.jsx)(i.A,{size:16})," Convert"]})})]}),(0,a.jsxs)("div",{...w(),className:"mt-4 border-2 border-dashed rounded-lg p-8 text-center "+(y?"border-sky-500 bg-sky-50":"border-slate-300"),children:[(0,a.jsx)("input",{...k()}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-slate-600",children:[(0,a.jsx)(c.A,{})," Drag & drop images here, or click to select"]})]})]}),(0,a.jsx)("div",{className:"grid gap-3",children:f.map((e,t)=>(0,a.jsx)("div",{className:"rounded-md border bg-white p-4 shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.file.name}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[Math.round(e.file.size/1024)," KB â†’ ",s.toUpperCase()]})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:["running"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[(0,a.jsx)("div",{className:"animate-spin h-3 w-3 border border-blue-600 border-t-transparent rounded-full"}),"Converting..."]}),"done"===e.status&&(0,a.jsxs)("div",{className:"text-xs text-emerald-600 flex items-center gap-1",children:[(0,a.jsx)(d.A,{size:14})," Converted successfully"]}),"error"===e.status&&(0,a.jsxs)("div",{className:"text-rose-600 flex items-center gap-1 text-xs",children:[(0,a.jsx)(m.A,{size:14})," ",e.error]}),"queued"===e.status&&(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Queued for conversion"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:"done"===e.status&&e.url&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>window.open(e.url,"_blank"),className:"inline-flex items-center gap-1 rounded-md bg-slate-100 px-3 py-1.5 text-slate-700 hover:bg-slate-200 text-sm",children:[(0,a.jsx)(x.A,{size:14})," Preview"]}),(0,a.jsxs)("a",{href:e.url,download:"".concat(e.file.name.split(".")[0],"_converted.").concat(s),className:"inline-flex items-center gap-1 rounded-md bg-emerald-600 px-3 py-1.5 text-white hover:bg-emerald-700 text-sm",children:[(0,a.jsx)(u.A,{size:16})," Download"]})]})})]})},"".concat(t,"-").concat(e.status,"-").concat(v)))},v)]})}},2527:(e,s,t)=>{Promise.resolve().then(t.bind(t,1920))},3988:(e,s,t)=>{"use strict";t.d(s,{H:()=>a});let a="http://localhost:8080"}},e=>{e.O(0,[108,825,441,964,358],()=>e(e.s=2527)),_N_E=e.O()}]);